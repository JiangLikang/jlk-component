# 从输入 url 到看到页面经历的所有事情

## 大体步骤

1. 输入网址
2. 缓存解析
3. 域名解析
4. TCP 连接，三次握手
5. 服务器响应
6. 页面渲染

## 输入网址

输入 url

## 缓存解析

浏览器获取这个 url，进行解析，先去缓存中看看有没有，在`路由器缓存`中查看，若有缓存，使用缓存。

> 缓存就是把你之前访问过的 web 资源，比如 js，css，图片什么的保存在本机的内存或是磁盘当中。

### HTTP 缓存机制

1. 浏览器每次发起请求，都会先在浏览器缓存中查找该请求的结果以及缓存标识
2. 浏览器每次拿到返回的请求结果都会将该结果和缓存标识存入浏览器缓存中

#### 强制缓存

浏览器发起 HTTP 请求

- 不存在缓存结果和缓存标识，则直接向服务器发起请求
- 存在缓存结果和缓存标识，但结果已经失效，则使用`协商缓存`
- 存在该缓存结果和缓存标识，且该结果没有还没有失效，直接返回该结果

控制强制缓存的请求头字段：`Cache-Control`

1. public：所有内容都将被缓存（客户端和代理服务器都可缓存）
2. private：所有内容只有客户端可以缓存，`Cache-Control的默认取值`
3. no-cache：客户端缓存内容，`但是是否使用缓存则需要经过协商缓存来验证决定`
4. no-store：所有内容都不会被缓存，即不使用强制缓存，也不使用协商缓存
5. max-age=xxx：缓存内容将在`xxx秒`后失效

状态码为灰色的请求则代表使用了强制缓存，请求对应的 Size 值则代表该缓存存放的位置，
分别为`from memory cache` 和 `from disk cache`

- from memory cache：使用内存中的缓存
- from disk cache：使用的是硬盘中的缓存
  (`读取缓存的顺序为memory –> disk`)

#### 协商缓存

协商缓存就是强制缓存失效后，浏览器携带缓存标识向服务器发起请求，`由服务器根据缓存标识决定是否使用缓存`的过程

- 返回`304`：该资源无更新
- 返回 200：该资源更新了

响应头字段`Last-Modified`：服务器响应请求时，返回该资源文件在服务器最后被修改的时间

######## 缓存总结

- 强制缓存优先于协商缓存进行，若强制缓存生效则直接使用缓存，若不生效则进行协商缓存。
- 协商缓存由服务器决定是否使用缓存，若协商缓存失效，那么代表该请求的缓存失效，重新获取请求结果，再存入浏览器缓存中； 缓存生效则返回 304，继续使用缓存。

## 域名解析

即：DNS 解析 `DNS(Domain Name System)：域名解析系统`

DNS 解析：域名到 IP 地址的转换过程。域名的解析工作由 DNS 服务器完成。解析后`可以获取域名相应的IP地址`

## TCP 连接 三次握手

1. 客户端向服务器发送连接请求报文 (`ACK=0 SYN=1 seq=x`)
2. 服务器端接受客户端发送的连接请求后后回复 ACK 报文，并为这次连接分配资源。 (`ACK=1 SYN=1 seq=y ack=x+1`)
3. 客户端接收到 ACK 报文后也向服务器端发生 ACK 报文，并分配资源。 (`ACK=1 seq=x+1 ack=y+1`)

4. 客户端：我要一个面包！
5. 服务器：让我找找，给你一个面包。
6. 客户端：我拿到面包啦~

## 服务器收到请求

服务器收到浏览器发送的请求信息，返回一个响应头和一个响应体。

## 页面渲染

浏览器收到服务器发送的响应头和响应体，进行客户端渲染，生成 Dom 树、解析 css 样式、js 交互。
